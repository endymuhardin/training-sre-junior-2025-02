# PostgreSQL Client Authentication Configuration
# Custom configuration for demo environment
# WARNING: This uses 'trust' auth for demo purposes only
# PRODUCTION: Use scram-sha-256 or md5 with strong passwords

# TYPE  DATABASE        USER            ADDRESS                 METHOD

# Local connections
local   all             all                                     trust
host    all             all             127.0.0.1/32            trust
host    all             all             ::1/128                 trust

# Replication connections
local   replication     all                                     trust
host    replication     all             127.0.0.1/32            trust
host    replication     all             ::1/128                 trust

# pg_auto_failover system connections (SSL required)
hostssl "postgres" "docker" postgres-primary trust
hostssl "postgres" "docker" postgres-replica1 trust
hostssl all "pgautofailover_monitor" pg-monitor trust
hostssl replication "pgautofailover_replicator" postgres-primary trust
hostssl replication "pgautofailover_replicator" postgres-replica1 trust
hostssl "postgres" "pgautofailover_replicator" postgres-primary trust
hostssl "postgres" "pgautofailover_replicator" postgres-replica1 trust

# HAProxy health check connections (specific IPs only)
host all haproxy_check 172.30.0.10/32 trust  # haproxy1
host all haproxy_check 172.30.0.11/32 trust  # haproxy2

# Application connections (specific IPs only)
host demodb app_user 172.30.0.10/32 md5  # via haproxy1
host demodb app_user 172.30.0.11/32 md5  # via haproxy2
host demodb app_user 172.30.0.30/32 md5  # app1 (direct, for testing)
host demodb app_user 172.30.0.31/32 md5  # app2 (direct, for testing)

# psql-client for admin access
host all all 172.30.0.22/32 trust  # psql-client container (all users/dbs)

# Database migration (init container)
host all docker 172.30.0.25/32 trust  # db-migrate container
