global
    log stdout format raw local0
    maxconn 4096
    stats socket /var/run/haproxy.sock mode 600 level admin
    stats timeout 2m

defaults
    log     global
    mode    http
    option  httplog
    option  dontlognull
    timeout connect 5000ms
    timeout client  50000ms
    timeout server  50000ms

# HAProxy Statistics Dashboard
frontend stats
    bind *:8404
    stats enable
    stats uri /
    stats refresh 5s
    stats show-legends
    stats show-node

# Frontend - Entry point
frontend http_front
    bind *:80
    default_backend nginx_backend

# Backend - Nginx instances
backend nginx_backend
    balance roundrobin
    option httpchk GET /
    http-check expect status 200

    server nginx1 nginx1:80 check inter 2s fall 3 rise 2
    server nginx2 nginx2:80 check inter 2s fall 3 rise 2
    server nginx3 nginx3:80 check inter 2s fall 3 rise 2
